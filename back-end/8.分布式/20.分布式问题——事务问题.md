# 分布式问题——事务问题

[推荐阅读——小米信息部技术团队：分布式事务，这一篇就够了](https://xiaomi-info.github.io/2020/01/02/distributed-transaction/)

当我们将单体应用拆分为分布式应用后，会自然的出现很多的问题，其中最常见的就是分布式事务问题

## 前置知识

### 事务

所谓事务也就是一系列严密的操作，这些操作要么同时完成，要么都不完成，这种操作一般具有以下属性：原子性，一致性，隔离性与持久性，也就是我们常说的ACID

## 场景

当我们去对数据库进行一次CRUD操作，那么很有可能会失败，这时SpringBoot为我们提供的事务注解（@Transaction）就可以在代码层面帮助我们完成回滚

但是在微服务场景下，由于不同的业务与库表可能部署在不同的服务器上，那么我们就不可能仅依靠一个注解就对完成事务

这时我们必须考虑其他的解决方案

## 三种一致性

- 强一致性：任何时刻下所有节点的数据完全一致
- 弱一致性：在一个时刻下，允许部分节点的数据不一致
- 最终一致性：不在追求一个时刻下的数据一致，仅要求在一段时间后数据可以一致


不难看出三种一致性的容忍度是逐渐加大的

使用微服务的代价和他使用他的好处一样的明显，其中一个代价就是一致性问题，较长时间的最终一致性会导致一个事件发布后只有在一段时间之后才能被读到，这种情况对于一些应用和业务来说是几乎无法容忍的

## CAP原则

Martin Fowler曾经在他的个人博客中提到过，微服务并不适合所有的软件开发情景。微服务的代价和它的好处一样明显。

 Eric Brewer在1998年提出微服务有三个指标
 
- Consistency
- Availability
- Partition tolerance


