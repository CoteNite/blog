# 搜索引擎

如果说一个后端程序员最先接触的四个中间件是什么，我一定会说是——MySQL，Redis，MQ，ElasticSearch

这里我们就来聊一下ElasticSearch的相关问题

(基础内容已经在另一篇文章中提到过，这里主要是将一些在实际使用时会遇到的问题)

## ES如何实现的分布式？

首先我们还是先来看一下ES的层级

```
index（表） -> type（7.0后被移除） -> mapping（表属性） -> document（行） -> field（列）
```

括号里面是和MySQL的大致类比（记住，只是类比，没有实际意义）

其中type没法跟MySQL类比，因为MySQL中就找不到类似的东西，一个Index中可以有多个type，type就是两个很像的Mapping，里面大部分字Field都一样，只有少量的Field不一样，这个东西在Es7.0以后已经被彻底的移除掉了

这上面同样不太准确的还有一个就是Mapping，Mapping其实应该算是Index的附带品，这个东西就像是你在创建MySQL表时的那个表的属性，定义了里面的Document长什么样子，同时还有一些这个Index自己的特点

ES的分布式是将Index拆分成多个Shard（分片），让后每个Shard春芳一部分数据，同时每个shard都有一个 `primary shard` ，负责写入数据，但是还有几个 `replica shard` 。 `primary shard` 写入数据之后，会将数据同步到其他几个 `replica shard` 上去。

通过这样的方案就实现了ES的 **高可用性**

同时ES多节点部署会自动选举一个节点作为Master节点，Master节点负责干一些管理工作，比如维护元数据(meta)，切换Primary Shard和Re




