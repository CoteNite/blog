# 分库分表

分库分表也是近年来常常会出现的一个问题，这玩意一般只会在**高并发，数据量大**的情况才会使用，其实你想想也就明白了，为什么要分库分表，说明单库单表不够用了呗，那为啥单库单表不够用？还不是因为装不下或者请求相应时间太长了

## 分表

有的单表都干到千万级了，这破表还扛得住吗，一个SQL查询直接慢到死，一般单表数据量达到百万也就该分表了

分表就是将一个表里的数据分开来存放，一般会找一个字段来区分，比如将原表按照用户id区分，这样找这个表下这个id的用户的数据只需要找这个表就行

## 分库

一般一个库也就支撑的起2000的并发量，一般到达1000并发的时候就要分库了，分库就是将原本一个库的数据分到多个库，访问时访问某个指定的库就行

（现在的分布式设计也有这个感觉，一般一个模块一个单独的库，大家互不干扰）

## 常见的分库分表中间件

这里主要提两个

### Mycat

基于老牌分库分表中间件Cobar进行改造，属于Proxy方案，也就是在应用服务器和数据库服务器中间单独架一个新的服务，由他来完成分发的功能

这个中间件曾经火过一阵子，但是我最近去查了一下好像又停止维护了，只能说大家相信老牌的开源方案不是没有理由的

或许有的公司还在使用这个方案并且在自己内部维护，但是如果公司能力不够，那还是选择一个持续维护的开源方案会比较好
### Apache Sharding Sphere

那要说老牌谁能比得过Apache呢，这里就给大家推荐Apache开源项目Sharding Sphere，其中有Sharding-JDBC和Sharding-Proxy两种方案，其中Sharding-Proxy就是上面提到的Proxy方案，而Sharding-JDBC则是client方案，也就是将分库分表的逻辑集成到你的应用当中

### 如何对数据库进行水平/垂直拆分

水平拆分就是将一个表横着裁成多个，表的结构相同，但是数据不同，这样做最大的意义就是将数据分散开来，因此来扛住更高的并发量，同时也更容易的进行扩容

垂直才分就是根据字段的业务逻辑拆分成多个表，这个就算不是高并发设计也很常见，比如用户表，用户详情表等，这样做最大的意义就是限制表的字段数量，放置一个表的字段过多进而影响SQL的响应速度